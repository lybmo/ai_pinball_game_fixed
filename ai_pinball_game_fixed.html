<!DOCTYPE html>

<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIÊô∫ËÉΩÂºπÁêÉÂ§ßÂ∏à</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4);
            background-size: 400% 400%;
            animation: gradientShift 10s ease infinite;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow-x: hidden;
            padding: 10px;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .game-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 15px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 95vw;
            width: 100%;
            max-height: 95vh;
            overflow-y: auto;
            position: relative;
        }

        header {
            text-align: center;
            margin-bottom: 15px;
        }

        h1 {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-size: clamp(1.5em, 4vw, 2.5em);
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .game-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }

        .info-item {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            font-weight: bold;
            font-size: clamp(0.8em, 2vw, 1em);
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s ease;
        }

        .info-item:hover {
            transform: translateY(-2px);
        }

        .game-canvas-wrapper {
            display: flex;
            justify-content: center;
            margin-bottom: 15px;
            position: relative;
            width: 100%;
        }

        #gameCanvas {
            border: 3px solid #333;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            background: #000;
            cursor: none;
            max-width: 100%;
            height: auto;
            display: block;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        button {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 10px 18px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            font-size: clamp(0.7em, 2vw, 0.9em);
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
            flex: 1 1 auto;
            min-width: 80px;
        }

        button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        button:hover::before {
            width: 300px;
            height: 300px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        button:active {
            transform: translateY(0);
        }

        .power-ups {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }

        .power-up {
            width: clamp(40px, 8vw, 60px);
            height: clamp(40px, 8vw, 60px);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: clamp(16px, 4vw, 24px);
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            position: relative;
        }

        .power-up:hover {
            transform: scale(1.1) rotate(10deg);
        }

        .power-up.active {
            animation: powerUpGlow 1s infinite;
        }

        @keyframes powerUpGlow {
            0%, 100% { box-shadow: 0 0 20px rgba(255, 255, 255, 0.8); }
            50% { box-shadow: 0 0 40px rgba(255, 255, 255, 1); }
        }

        .message {
            text-align: center;
            padding: 12px;
            border-radius: 10px;
            margin-top: 15px;
            font-weight: bold;
            transition: all 0.3s ease;
            opacity: 0;
            transform: translateY(-20px);
            font-size: clamp(0.8em, 2vw, 1em);
        }

        .message.show {
            opacity: 1;
            transform: translateY(0);
        }

        .success {
            background: linear-gradient(135deg, #84fab0, #8fd3f4);
            color: #155724;
        }

        .info {
            background: linear-gradient(135deg, #a8edea, #fed6e3);
            color: #0c5460;
        }

        .warning {
            background: linear-gradient(135deg, #ffecd2, #fcb69f);
            color: #856404;
        }

        .ai-status {
            text-align: center;
            margin: 10px 0;
            font-style: italic;
            color: #666;
            background: rgba(255, 255, 255, 0.8);
            padding: 8px;
            border-radius: 10px;
            transition: all 0.3s ease;
            font-size: clamp(0.8em, 2vw, 1em);
        }

        .difficulty-selector {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .difficulty-btn {
            padding: 6px 14px;
            border-radius: 18px;
            font-size: clamp(0.7em, 2vw, 0.9em);
            background: linear-gradient(135deg, #ff9a9e, #fecfef);
            flex: 1 1 auto;
            min-width: 70px;
        }

        .difficulty-btn.active {
            background: linear-gradient(135deg, #84fab0, #8fd3f4);
        }

        .combo-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: clamp(2em, 5vw, 3em);
            font-weight: bold;
            color: #ff6b6b;
            pointer-events: none;
            opacity: 0;
            animation: comboPopup 1s ease-out;
        }

        @keyframes comboPopup {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.5);
            }
            50% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1.2);
            }
            100% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(1);
            }
        }

        @media (max-width: 768px) {
            .game-container {
                padding: 10px;
                margin: 5px;
            }

            .controls {
                gap: 5px;
            }
            
            button {
                padding: 8px 14px;
                font-size: 0.8em;
            }
            
            .power-up {
                width: 45px;
                height: 45px;
                font-size: 18px;
            }
            
            .info-item {
                padding: 6px 10px;
                font-size: 0.8em;
            }
        }
        
        @media (max-width: 480px) {
            .game-container {
                padding: 5px;
            }
            
            .controls {
                gap: 3px;
            }
            
            button {
                padding: 6px 10px;
                font-size: 0.7em;
                min-width: 60px;
            }
            
            .power-up {
                width: 35px;
                height: 35px;
                font-size: 14px;
            }
            
            .difficulty-btn {
                padding: 4px 10px;
                font-size: 0.7em;
                min-width: 60px;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <header>
            <h1>üéÆ AIÊô∫ËÉΩÂºπÁêÉÂ§ßÂ∏à üéØ</h1>
            <p style="font-size: clamp(0.8em, 2vw, 1em);">ÁßªÂä®Èº†Ê†áÊéßÂà∂Êå°ÊùøÔºåÂáªÁ¢éÊâÄÊúâÁ†ñÂùóÔºÅAI‰ºöÈ¢ÑÊµãÊúÄ‰Ω≥ÂáªÁêÉËßíÂ∫¶„ÄÇ</p>
        </header>

        <section class="game-info">
            <div class="info-item">ÂæóÂàÜ: <span id="score">0</span></div>
            <div class="info-item">Á≠âÁ∫ß: <span id="level">1</span></div>
            <div class="info-item">ÁîüÂëΩ: <span id="lives">3</span></div>
            <div class="info-item">ËøûÂáª: <span id="combo">0</span></div>
            <div class="info-item">AIÈ¢ÑÊµã: <span id="ai-prediction">Â∞±Áª™</span></div>
        </section>

        <section class="difficulty-selector">
            <button class="difficulty-btn active" data-difficulty="easy">ÁÆÄÂçï</button>
            <button class="difficulty-btn" data-difficulty="normal">ÊôÆÈÄö</button>
            <button class="difficulty-btn" data-difficulty="hard">Âõ∞Èöæ</button>
            <button class="difficulty-btn" data-difficulty="ai">AIÂ§ßÂ∏à</button>
        </section>

        <main class="game-canvas-wrapper">
            <canvas id="gameCanvas" width="800" height="500"></canvas>
            <div class="combo-indicator" id="comboIndicator"></div>
        </main>

        <section class="power-ups">
            <div class="power-up" style="background: linear-gradient(135deg, #ff6b6b, #ff8e53);" data-power="multiball" title="Â§öÁêÉÊ®°Âºè">‚ö°</div>
            <div class="power-up" style="background: linear-gradient(135deg, #4ecdc4, #44a08d);" data-power="slowmo" title="ÊÖ¢Âä®‰Ωú">üêå</div>
            <div class="power-up" style="background: linear-gradient(135deg, #f093fb, #f5576c);" data-power="bigpaddle" title="Â§ßÊå°Êùø">üî∑</div>
            <div class="power-up" style="background: linear-gradient(135deg, #fa709a, #fee140);" data-power="laser" title="ÊøÄÂÖâÁÇÆ">üî´</div>
            <div class="power-up" style="background: linear-gradient(135deg, #30cfd0, #330867);" data-power="aiassist" title="AIËæÖÂä©">ü§ñ</div>
        </section>

        <section class="controls">
            <button onclick="startGame()">üéÆ ÂºÄÂßã</button>
            <button onclick="pauseGame()">‚è∏Ô∏è ÊöÇÂÅú</button>
            <button onclick="resetGame()">üîÑ ÈáçÁΩÆ</button>
            <button onclick="toggleAIAssist()">ü§ñ AIËæÖÂä©</button>
            <button onclick="activateRandomPowerUp()">üéÅ ÈÅìÂÖ∑</button>
        </section>

        <div class="ai-status" id="ai-status">AIÂä©ÊâãÂ∑≤Â∞±Áª™ÔºåÂáÜÂ§áÂàÜÊûêÂºπÁêÉËΩ®Ëøπ...</div>
        <div class="message" id="message"></div>
    </div>

    <script>
        class PinballGame {
            constructor() {
                this.canvas = document.getElementById('gameCanvas');
                this.ctx = this.canvas.getContext('2d');
                
                // ÂìçÂ∫îÂºèÁîªÂ∏ÉÂ∞∫ÂØ∏
                this.setupCanvas();
                window.addEventListener('resize', () => this.setupCanvas());
                
                this.width = this.canvas.width;
                this.height = this.canvas.height;
                
                // Ê∏∏ÊàèÁä∂ÊÄÅ
                this.gameState = 'waiting'; // waiting, playing, paused, gameOver
                this.score = 0;
                this.level = 1;
                this.lives = 3;
                this.combo = 0;
                this.maxCombo = 0;
                
                // ÈöæÂ∫¶ËÆæÁΩÆ
                this.difficulties = {
                    easy: { ballSpeed: 4, paddleWidth: 120, brickRows: 3 },
                    normal: { ballSpeed: 6, paddleWidth: 100, brickRows: 4 },
                    hard: { ballSpeed: 8, paddleWidth: 80, brickRows: 5 },
                    ai: { ballSpeed: 10, paddleWidth: 60, brickRows: 6 }
                };
                this.currentDifficulty = 'easy';
                
                // Ê∏∏ÊàèÂØπË±°
                this.paddle = {
                    x: this.width / 2 - 60,
                    y: this.height - 30,
                    width: 120,
                    height: 15,
                    speed: 8,
                    color: '#4ecdc4'
                };
                
                this.balls = [];
                this.bricks = [];
                this.particles = [];
                this.powerUps = [];
                
                // AIÁõ∏ÂÖ≥
                this.aiAssist = false;
                this.aiPrediction = '';
                this.mouseX = this.width / 2;
                
                // ÈÅìÂÖ∑Á≥ªÁªü
                this.activePowerUps = {};
                this.powerUpTypes = ['multiball', 'slowmo', 'bigpaddle', 'laser', 'aiassist'];
                
                this.init();
            }
            
            setupCanvas() {
                const container = this.canvas.parentElement;
                const maxWidth = container.clientWidth;
                
                if (maxWidth < 800) {
                    const scale = maxWidth / 800;
                    this.canvas.width = Math.max(400, 800 * scale);
                    this.canvas.height = Math.max(250, 500 * scale);
                } else {
                    this.canvas.width = 800;
                    this.canvas.height = 500;
                }
            }
            
            init() {
                this.setupEventListeners();
                this.createBricks();
                this.createBall();
                this.gameLoop();
            }
            
            setupEventListeners() {
                this.canvas.addEventListener('mousemove', (e) => {
                    const rect = this.canvas.getBoundingClientRect();
                    this.mouseX = e.clientX - rect.left;
                    
                    if (this.gameState === 'playing') {
                        this.paddle.x = Math.max(0, Math.min(this.width - this.paddle.width, this.mouseX - this.paddle.width / 2));
                    }
                });
                
                // Ëß¶Êë∏ÊîØÊåÅ
                this.canvas.addEventListener('touchmove', (e) => {
                    e.preventDefault();
                    const rect = this.canvas.getBoundingClientRect();
                    const touch = e.touches[0];
                    this.mouseX = touch.clientX - rect.left;
                    
                    if (this.gameState === 'playing') {
                        this.paddle.x = Math.max(0, Math.min(this.width - this.paddle.width, this.mouseX - this.paddle.width / 2));
                    }
                });
                
                document.querySelectorAll('.difficulty-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        document.querySelectorAll('.difficulty-btn').forEach(b => b.classList.remove('active'));
                        e.target.classList.add('active');
                        this.changeDifficulty(e.target.dataset.difficulty);
                    });
                });
                
                document.querySelectorAll('.power-up').forEach(powerUp => {
                    powerUp.addEventListener('click', (e) => {
                        const power = e.target.dataset.power;
                        this.activatePowerUp(power);
                    });
                });
            }
            
            changeDifficulty(difficulty) {
                this.currentDifficulty = difficulty;
                const settings = this.difficulties[difficulty];
                this.paddle.width = settings.paddleWidth;
                
                if (this.balls.length > 0) {
                    this.balls.forEach(ball => {
                        const speed = Math.sqrt(ball.dx * ball.dx + ball.dy * ball.dy);
                        const ratio = settings.ballSpeed / speed;
                        ball.dx *= ratio;
                        ball.dy *= ratio;
                    });
                }
                
                this.showMessage(`ÈöæÂ∫¶ÂàáÊç¢Âà∞${difficulty === 'easy' ? 'ÁÆÄÂçï' : difficulty === 'normal' ? 'ÊôÆÈÄö' : difficulty === 'hard' ? 'Âõ∞Èöæ' : 'AIÂ§ßÂ∏à'}Ê®°Âºè`, 'info');
                this.updateAIStatus(`AIÂàÜÊûêÔºö${difficulty}Ê®°ÂºèÂ∑≤ÊøÄÊ¥ª`);
            }
            
            createBricks() {
                this.bricks = [];
                const settings = this.difficulties[this.currentDifficulty];
                const rows = settings.brickRows;
                const cols = 10;
                const brickWidth = Math.min(70, this.width / 12);
                const brickHeight = Math.min(20, this.height / 25);
                const padding = 5;
                const offsetX = (this.width - (cols * (brickWidth + padding))) / 2;
                const offsetY = 60;
                
                const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#ffd93d', '#ff6bcb'];
                
                for (let r = 0; r < rows; r++) {
                    for (let c = 0; c < cols; c++) {
                        this.bricks.push({
                            x: offsetX + c * (brickWidth + padding),
                            y: offsetY + r * (brickHeight + padding),
                            width: brickWidth,
                            height: brickHeight,
                            color: colors[r % colors.length],
                            points: (rows - r) * 10,
                            hits: rows - r > 3 ? 2 : 1,
                            maxHits: rows - r > 3 ? 2 : 1,
                            powerUp: Math.random() < 0.1 ? this.powerUpTypes[Math.floor(Math.random() * this.powerUpTypes.length)] : null
                        });
                    }
                }
            }
            
            createBall(x = null, y = null) {
                const settings = this.difficulties[this.currentDifficulty];
                this.balls.push({
                    x: x || this.width / 2,
                    y: y || this.height - 50,
                    dx: (Math.random() - 0.5) * settings.ballSpeed,
                    dy: -settings.ballSpeed,
                    radius: Math.max(6, this.width / 133),
                    color: '#fff',
                    trail: []
                });
            }
            
            update() {
                if (this.gameState !== 'playing') return;
                
                // Êõ¥Êñ∞ÁêÉ
                for (let i = this.balls.length - 1; i >= 0; i--) {
                    const ball = this.balls[i];
                    
                    // Ê∑ªÂä†ËΩ®Ëøπ
                    ball.trail.push({ x: ball.x, y: ball.y });
                    if (ball.trail.length > 10) ball.trail.shift();
                    
                    ball.x += ball.dx;
                    ball.y += ball.dy;
                    
                    // Â¢ôÂ£ÅÁ¢∞Êíû
                    if (ball.x + ball.radius > this.width || ball.x - ball.radius < 0) {
                        ball.dx = -ball.dx;
                        this.createParticles(ball.x, ball.y, '#4ecdc4');
                    }
                    if (ball.y - ball.radius < 0) {
                        ball.dy = -ball.dy;
                        this.createParticles(ball.x, ball.y, '#4ecdc4');
                    }
                    
                    // Â∫ïÈÉ®Ê£ÄÊµã
                    if (ball.y - ball.radius > this.height) {
                        this.balls.splice(i, 1);
                        if (this.balls.length === 0) {
                            this.loseLife();
                        }
                        continue;
                    }
                    
                    // Êå°ÊùøÁ¢∞Êíû
                    if (this.checkPaddleCollision(ball)) {
                        const hitPos = (ball.x - this.paddle.x) / this.paddle.width;
                        ball.dx = 8 * (hitPos - 0.5);
                        ball.dy = -Math.abs(ball.dy);
                        this.createParticles(ball.x, ball.y, this.paddle.color);
                        this.combo = 0;
                    }
                    
                    // Á†ñÂùóÁ¢∞Êíû
                    for (let j = this.bricks.length - 1; j >= 0; j--) {
                        const brick = this.bricks[j];
                        if (this.checkBrickCollision(ball, brick)) {
                            ball.dy = -ball.dy;
                            brick.hits--;
                            
                            if (brick.hits <= 0) {
                                this.score += brick.points * (this.combo + 1);
                                this.combo++;
                                this.createParticles(brick.x + brick.width/2, brick.y + brick.height/2, brick.color);
                                
                                if (brick.powerUp) {
                                    this.createPowerUp(brick.x + brick.width/2, brick.y + brick.height/2, brick.powerUp);
                                }
                                
                                this.bricks.splice(j, 1);
                                
                                if (this.combo > this.maxCombo) {
                                    this.maxCombo = this.combo;
                                    this.showCombo(this.combo);
                                }
                                
                                if (this.bricks.length === 0) {
                                    this.nextLevel();
                                }
                            }
                            break;
                        }
                    }
                }
                
                // AIÈ¢ÑÊµã
                if (this.aiAssist && this.balls.length > 0) {
                    this.predictBallPath();
                }
                
                // Êõ¥Êñ∞Á≤íÂ≠ê
                this.particles = this.particles.filter(p => p.life > 0);
                this.particles.forEach(p => {
                    p.x += p.dx;
                    p.y += p.dy;
                    p.life--;
                    p.dy += 0.1;
                });
                
                // Êõ¥Êñ∞ÈÅìÂÖ∑
                this.powerUps = this.powerUps.filter(p => p.y < this.height);
                this.powerUps.forEach(p => {
                    p.y += 2;
                    p.rotation += 0.05;
                    
                    if (this.checkPowerUpCollision(p)) {
                        this.activatePowerUp(p.type);
                        this.powerUps = this.powerUps.filter(powerUp => powerUp !== p);
                    }
                });
                
                // Êõ¥Êñ∞ÈÅìÂÖ∑ÊïàÊûú
                this.updatePowerUps();
                
                this.updateUI();
            }
            
            checkPaddleCollision(ball) {
                return ball.x > this.paddle.x &&
                       ball.x < this.paddle.x + this.paddle.width &&
                       ball.y + ball.radius > this.paddle.y &&
                       ball.y - ball.radius < this.paddle.y + this.paddle.height;
            }
            
            checkBrickCollision(ball, brick) {
                return ball.x + ball.radius > brick.x &&
                       ball.x - ball.radius < brick.x + brick.width &&
                       ball.y + ball.radius > brick.y &&
                       ball.y - ball.radius < brick.y + brick.height;
            }
            
            checkPowerUpCollision(powerUp) {
                return powerUp.x > this.paddle.x &&
                       powerUp.x < this.paddle.x + this.paddle.width &&
                       powerUp.y > this.paddle.y &&
                       powerUp.y < this.paddle.y + this.paddle.height;
            }
            
            predictBallPath() {
                if (this.balls.length === 0) return;
                
                const ball = this.balls[0];
                let predictX = ball.x;
                let predictY = ball.y;
                let predictDx = ball.dx;
                let predictDy = ball.dy;
                
                // Ê®°ÊãüÊú™Êù•Ë∑ØÂæÑ
                for (let i = 0; i < 50; i++) {
                    predictX += predictDx;
                    predictY += predictDy;
                    
                    if (predictX + 8 > this.width || predictX - 8 < 0) predictDx = -predictDx;
                    if (predictY - 8 < 0) predictDy = -predictDy;
                    
                    if (predictY > this.paddle.y - 20 && predictDy > 0) {
                        const targetX = predictX;
                        const recommendation = targetX < this.paddle.x + this.paddle.width/2 ? 'Â∑¶Áßª' : 'Âè≥Áßª';
                        this.aiPrediction = recommendation;
                        document.getElementById('ai-prediction').textContent = recommendation;
                        break;
                    }
                }
            }
            
            createParticles(x, y, color) {
                for (let i = 0; i < 10; i++) {
                    this.particles.push({
                        x: x,
                        y: y,
                        dx: (Math.random() - 0.5) * 4,
                        dy: (Math.random() - 0.5) * 4,
                        radius: Math.random() * 3 + 1,
                        color: color,
                        life: 30
                    });
                }
            }
            
            createPowerUp(x, y, type) {
                this.powerUps.push({
                    x: x,
                    y: y,
                    type: type,
                    rotation: 0,
                    icon: this.getPowerUpIcon(type)
                });
            }
            
            getPowerUpIcon(type) {
                const icons = {
                    multiball: '‚ö°',
                    slowmo: 'üêå',
                    bigpaddle: 'üî∑',
                    laser: 'üî´',
                    aiassist: 'ü§ñ'
                };
                return icons[type] || 'üéÅ';
            }
            
            activatePowerUp(type) {
                if (this.activePowerUps[type]) return;
                
                this.activePowerUps[type] = 300; // 5ÁßíÊïàÊûú
                
                switch(type) {
                    case 'multiball':
                        for (let i = 0; i < 2; i++) {
                            this.createBall(this.balls[0]?.x, this.balls[0]?.y);
                        }
                        this.showMessage('Â§öÁêÉÊ®°ÂºèÊøÄÊ¥ªÔºÅ', 'info');
                        break;
                    case 'slowmo':
                        this.balls.forEach(ball => {
                            ball.dx *= 0.5;
                            ball.dy *= 0.5;
                        });
                        this.showMessage('ÊÖ¢Âä®‰ΩúÊ®°ÂºèÊøÄÊ¥ªÔºÅ', 'info');
                        break;
                    case 'bigpaddle':
                        this.paddle.width = Math.min(180, this.width * 0.3);
                        this.showMessage('Â§ßÊå°ÊùøÊ®°ÂºèÊøÄÊ¥ªÔºÅ', 'info');
                        break;
                    case 'laser':
                        this.showMessage('ÊøÄÂÖâÁÇÆÊ®°ÂºèÊøÄÊ¥ªÔºÅ', 'info');
                        break;
                    case 'aiassist':
                        this.aiAssist = true;
                        this.showMessage('AIËæÖÂä©Ê®°ÂºèÊøÄÊ¥ªÔºÅ', 'info');
                        break;
                }
                
                // È´ò‰∫ÆÈÅìÂÖ∑ÊåâÈíÆ
                document.querySelector(`[data-power="${type}"]`).classList.add('active');
            }
            
            updatePowerUps() {
                Object.keys(this.activePowerUps).forEach(type => {
                    this.activePowerUps[type]--;
                    
                    if (this.activePowerUps[type] <= 0) {
                        delete this.activePowerUps[type];
                        document.querySelector(`[data-power="${type}"]`).classList.remove('active');
                        
                        // ÁßªÈô§ÊïàÊûú
                        switch(type) {
                            case 'slowmo':
                                this.balls.forEach(ball => {
                                    ball.dx *= 2;
                                    ball.dy *= 2;
                                });
                                break;
                            case 'bigpaddle':
                                this.paddle.width = this.difficulties[this.currentDifficulty].paddleWidth;
                                break;
                            case 'aiassist':
                                this.aiAssist = false;
                                this.aiPrediction = '';
                                document.getElementById('ai-prediction').textContent = 'Â∞±Áª™';
                                break;
                        }
                    }
                });
            }
            
            render() {
                // Ê∏ÖÁ©∫ÁîªÂ∏É
                this.ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
                this.ctx.fillRect(0, 0, this.width, this.height);
                
                // ÁªòÂà∂Á†ñÂùó
                this.bricks.forEach(brick => {
                    this.ctx.fillStyle = brick.color;
                    this.ctx.fillRect(brick.x, brick.y, brick.width, brick.height);
                    
                    if (brick.hits < brick.maxHits) {
                        this.ctx.fillStyle = 'rgba(255, 255, 255, 0.3)';
                        this.ctx.fillRect(brick.x, brick.y, brick.width, brick.height);
                    }
                    
                    // ÁªòÂà∂ÈÅìÂÖ∑ÂõæÊ†á
                    if (brick.powerUp) {
                        this.ctx.font = `${Math.max(12, brick.width/2)}px Arial`;
                        this.ctx.fillText(this.getPowerUpIcon(brick.powerUp), brick.x + brick.width/2 - 8, brick.y + brick.height/2 + 5);
                    }
                });
                
                // ÁªòÂà∂Êå°Êùø
                const gradient = this.ctx.createLinearGradient(this.paddle.x, this.paddle.y, this.paddle.x, this.paddle.y + this.paddle.height);
                gradient.addColorStop(0, this.paddle.color);
                gradient.addColorStop(1, '#2c3e50');
                this.ctx.fillStyle = gradient;
                this.ctx.fillRect(this.paddle.x, this.paddle.y, this.paddle.width, this.paddle.height);
                
                // ÁªòÂà∂ÁêÉ
                this.balls.forEach(ball => {
                    // ÁªòÂà∂ËΩ®Ëøπ
                    ball.trail.forEach((point, index) => {
                        this.ctx.fillStyle = `rgba(255, 255, 255, ${index / ball.trail.length * 0.5})`;
                        this.ctx.beginPath();
                        this.ctx.arc(point.x, point.y, ball.radius * (index / ball.trail.length), 0, Math.PI * 2);
                        this.ctx.fill();
                    });
                    
                    // ÁªòÂà∂ÁêÉ
                    this.ctx.fillStyle = ball.color;
                    this.ctx.beginPath();
                    this.ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
                    this.ctx.fill();
                });
                
                // ÁªòÂà∂Á≤íÂ≠ê
                this.particles.forEach(p => {
                    this.ctx.fillStyle = p.color + Math.floor(p.life / 30 * 255).toString(16).padStart(2, '0');
                    this.ctx.beginPath();
                    this.ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
                    this.ctx.fill();
                });
                
                // ÁªòÂà∂ÈÅìÂÖ∑
                this.powerUps.forEach(p => {
                    this.ctx.save();
                    this.ctx.translate(p.x, p.y);
                    this.ctx.rotate(p.rotation);
                    this.ctx.font = `${Math.max(16, this.width/50)}px Arial`;
                    this.ctx.fillText(p.icon, -10, 5);
                    this.ctx.restore();
                });
                
                // AIÈ¢ÑÊµãÁ∫ø
                if (this.aiAssist && this.balls.length > 0) {
                    this.ctx.strokeStyle = 'rgba(255, 255, 0, 0.5)';
                    this.ctx.lineWidth = 2;
                    this.ctx.setLineDash([5, 5]);
                    this.ctx.beginPath();
                    this.ctx.moveTo(this.balls[0].x, this.balls[0].y);
                    
                    let predictX = this.balls[0].x;
                    let predictY = this.balls[0].y;
                    let predictDx = this.balls[0].dx;
                    let predictDy = this.balls[0].dy;
                    
                    for (let i = 0; i < 30; i++) {
                        predictX += predictDx;
                        predictY += predictDy;
                        this.ctx.lineTo(predictX, predictY);
                        
                        if (predictX + 8 > this.width || predictX - 8 < 0) predictDx = -predictDx;
                        if (predictY - 8 < 0) predictDy = -predictDy;
                        if (predictY > this.height) break;
                    }
                    
                    this.ctx.stroke();
                    this.ctx.setLineDash([]);
                }
            }
            
            gameLoop() {
                this.update();
                this.render();
                requestAnimationFrame(() => this.gameLoop());
            }
            
            startGame() {
                if (this.gameState === 'waiting' || this.gameState === 'gameOver') {
                    this.resetGame();
                    this.gameState = 'playing';
                    this.showMessage('Ê∏∏ÊàèÂºÄÂßãÔºÅ', 'success');
                    this.updateAIStatus('AIÂàÜÊûêÔºöÊ∏∏ÊàèÂ∑≤ÂºÄÂßãÔºåÁ•ù‰Ω†Â•ΩËøêÔºÅ');
                }
            }
            
            pauseGame() {
                if (this.gameState === 'playing') {
                    this.gameState = 'paused';
                    this.showMessage('Ê∏∏ÊàèÊöÇÂÅú', 'info');
                } else if (this.gameState === 'paused') {
                    this.gameState = 'playing';
                    this.showMessage('Ê∏∏ÊàèÁªßÁª≠', 'info');
                }
            }
            
            resetGame() {
                this.gameState = 'waiting';
                this.score = 0;
                this.level = 1;
                this.lives = 3;
                this.combo = 0;
                this.balls = [];
                this.particles = [];
                this.powerUps = [];
                this.activePowerUps = {};
                this.createBricks();
                this.createBall();
                this.updateUI();
                this.showMessage('Ê∏∏ÊàèÂ∑≤ÈáçÁΩÆ', 'info');
            }
            
            loseLife() {
                this.lives--;
                this.combo = 0;
                
                if (this.lives <= 0) {
                    this.gameOver();
                } else {
                    this.createBall();
                    this.showMessage(`Â§±Âéª‰∏ÄÊù°ÁîüÂëΩÔºÅÂâ©‰Ωô ${this.lives} Êù°`, 'warning');
                    this.updateAIStatus(`AIÂàÜÊûêÔºöÂ∞èÂøÉÔºÅËøòÊúâ${this.lives}Êù°ÁîüÂëΩ`);
                }
            }
            
            gameOver() {
                this.gameState = 'gameOver';
                this.showMessage(`Ê∏∏ÊàèÁªìÊùüÔºÅÊúÄÁªàÂæóÂàÜÔºö${this.score}`, 'warning');
                this.updateAIStatus('AIÂàÜÊûêÔºöÊ∏∏ÊàèÁªìÊùüÔºåÂÜçÊé•ÂÜçÂéâÔºÅ');
            }
            
            nextLevel() {
                this.level++;
                this.lives = Math.min(this.lives + 1, 5);
                this.createBricks();
                this.createBall();
                this.showMessage(`ÊÅ≠ÂñúËøõÂÖ•Á¨¨ ${this.level} ÂÖ≥ÔºÅ`, 'success');
                this.updateAIStatus(`AIÂàÜÊûêÔºöÁ¨¨${this.level}ÂÖ≥ÔºåÈöæÂ∫¶ÊèêÂçáÔºÅ`);
            }
            
            toggleAIAssist() {
                this.aiAssist = !this.aiAssist;
                this.showMessage(this.aiAssist ? 'AIËæÖÂä©Â∑≤ÂºÄÂêØ' : 'AIËæÖÂä©Â∑≤ÂÖ≥Èó≠', 'info');
                this.updateAIStatus(this.aiAssist ? 'AIËæÖÂä©Ê®°ÂºèÊøÄÊ¥ª' : 'AIËæÖÂä©Ê®°ÂºèÂÖ≥Èó≠');
            }
            
            activateRandomPowerUp() {
                const randomPower = this.powerUpTypes[Math.floor(Math.random() * this.powerUpTypes.length)];
                this.activatePowerUp(randomPower);
            }
            
            showCombo(combo) {
                const indicator = document.getElementById('comboIndicator');
                indicator.textContent = `${combo}ËøûÂáªÔºÅ`;
                indicator.style.animation = 'none';
                setTimeout(() => {
                    indicator.style.animation = 'comboPopup 1s ease-out';
                }, 10);
            }
            
            showMessage(text, type) {
                const messageEl = document.getElementById('message');
                messageEl.textContent = text;
                messageEl.className = `message ${type} show`;
                
                setTimeout(() => {
                    messageEl.classList.remove('show');
                }, 3000);
            }
            
            updateAIStatus(text) {
                document.getElementById('ai-status').textContent = text;
            }
            
            updateUI() {
                document.getElementById('score').textContent = this.score;
                document.getElementById('level').textContent = this.level;
                document.getElementById('lives').textContent = this.lives;
                document.getElementById('combo').textContent = this.combo;
            }
        }
        
        // ÂÖ®Â±ÄÂáΩÊï∞
        let game;
        
        function startGame() {
            game.startGame();
        }
        
        function pauseGame() {
            game.pauseGame();
        }
        
        function resetGame() {
            game.resetGame();
        }
        
        function toggleAIAssist() {
            game.toggleAIAssist();
        }
        
        function activateRandomPowerUp() {
            game.activateRandomPowerUp();
        }
        
        // ÂêØÂä®Ê∏∏Êàè
        document.addEventListener('DOMContentLoaded', () => {
            game = new PinballGame();
        });
    </script>
</body>
</html>
